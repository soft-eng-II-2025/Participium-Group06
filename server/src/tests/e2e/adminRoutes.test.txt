import request from "supertest";
import {app} from "../../index";
import {TestDataSource} from "../test-data-source";


describe("E2E: adminRoutes", () => {
    beforeAll(async () => {
        if (TestDataSource.isInitialized) await TestDataSource.destroy();
        await TestDataSource.initialize();
    });

    it("POST /api/admin/accounts/register -> registra nuovo officer", async () => {
        const payload = {
            username: "officer1",
            email: "officer1@comune.it",
            password: "password123",
            first_name: "Mario",
            last_name: "Rossi",
        };

        const res = await request(app)
            .post("/api/admin/accounts/register")
            .send(payload);

        expect([200, 201]).toContain(res.status);
        expect(res.body).toHaveProperty("username", "officer1");
    });

    it("GET /api/admin/accounts/list -> ritorna lista officer", async () => {
        const res = await request(app).get("/api/admin/accounts/list");
        expect([200, 201]).toContain(res.status);
        expect(Array.isArray(res.body)).toBe(true);
    });

    it("GET /api/admin/roles/list -> ritorna ruoli", async () => {
        const res = await request(app).get("/api/admin/roles/list");
        expect([200, 201]).toContain(res.status);
        expect(Array.isArray(res.body)).toBe(true);
    });
});
